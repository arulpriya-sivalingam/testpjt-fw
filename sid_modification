#!/usr/bin/env python3

import re
import sys
from pathlib import Path

RULE_FILE = sys.argv[1] if len(sys.argv) > 1 else None

if not RULE_FILE:
    print("Usage: python normalize_sid_field.py <rules-file>")
    sys.exit(1)

path = Path(RULE_FILE)
if not path.exists():
    print(f"❌ File not found: {RULE_FILE}")
    sys.exit(1)

# Regex: match `; sid:` or `;  sid:` or `;    sid:` but NOT already `;sid:`
pattern = re.compile(r";\s+sid\s*:")

fixed_lines = []

with open(RULE_FILE, "r") as f:
    for line in f:
        new_line = pattern.sub(";sid:", line)
        fixed_lines.append(new_line)

# Write back to same file (in-place fix)
with open(RULE_FILE, "w") as f:
    f.writelines(fixed_lines)

print(f"✅ Normalized SID formatting in: {RULE_FILE}")
print("All occurrences of '; sid:' → ';sid:'")
